<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íšŒì›ìˆ˜ì •</title>
  <link rel="stylesheet" href="../css/user/regiest.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <script src="https://kit.fontawesome.com/599a3a7868.js" crossorigin="anonymous"></script>

  <!-- ì¹´ì¹´ì˜¤ ì£¼ì†Œ API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=0f0c892be57f61276f534d3ff4c7601b&libraries=services"></script>
  <script>
    // ì „ì—­ ë³€ìˆ˜ë¡œ map ì„ ì–¸
    var map;

    window.onload = function() {
      if (typeof kakao !== "undefined") {
        // ì§€ë„ ìƒì„±
        var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
                mapOption = {
                  center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì˜ ìœ„ë„ì™€ ê²½ë„ (ê¸°ë³¸ ê°’)
                  level: 3 // ì§€ë„ í™•ëŒ€ ë ˆë²¨
                };

        map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ ìƒì„±
        console.log("map: ", map);
      } else {
        console.log("ì¹´ì¹´ì˜¤ ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      }
    };

  </script>



</head>
<body>
<div th:replace="include/header :: headerFragment"></div>

<div class="wrap">
  <div class="form-container">
    <h2 class="title">WORKLET</h2>
    <h2>íšŒì›ì •ë³´ ìˆ˜ì •</h2>
    <form action="/user/modify" method="post" name="registForm">
      <div class="form">
        <div class="form-row">
          <label class="username">ì•„ì´ë””</label>
          <input type="text" name="userId" id="id"  th:value="${user.userId}" readonly>

          <span id="check-result"></span>

        </div>

        <div class="form-row">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" name="userPw" id="password" placeholder="8~16ì ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨">
        </div>

        <div class="form-row">
          <label for="passwordCheck">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="passwordCheck" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
        </div>

        <div class="form-row">
          <label>ì´ë¦„</label>
          <input type="text" id="name" name="userName"  th:value="${user.userName}">
        </div>

        <div class="form-row">
          <label>ì„±ë³„</label>
          <div class="radio-group">
            <label><input type="radio" name="userGender" value="ë‚¨ì„±"  th:checked="${user.userGender=='ë‚¨ì„±'}"> ë‚¨ì„±</label>
            <label><input type="radio" name="userGender" value="ì—¬ì„±"  th:checked="${user.userGender=='ì—¬ì„±'}"> ì—¬ì„±</label>
          </div>
        </div>

        <div class="form-row">
          <label>ìƒë…„ì›”ì¼</label>
          <div class="birth-row">
            <input type="text" class="small" id="birthYear"  th:value="${user.userBirthday.substring(0, 4)}">
            <input type="text" class="small" id="birthMonth"  th:value="${user.userBirthday.substring(5, 7)}">
            <input type="text" class="small" id="birthDay"  th:value="${user.userBirthday.substring(8, 10)}">
            <input type="hidden" name="userBirthday" id="userBirthday" th:value="${user.userBirthday}">
          </div>
        </div>

        <div class="form-row">
          <label>ì—°ë½ì²˜</label>
          <input type="text" placeholder="000-0000-0000" name="userPhone"  th:value="${user.userPhone}">
        </div>

        <div class="form-row">
          <label>ì´ë©”ì¼</label>
          <input type="email" placeholder="example@email.com" name="userEmail"  th:value="${user.userEmail}">
        </div>

        <div class="form-row flex  address">
          <label for="userAddress">ì£¼ì†Œ</label>
          <div class="flex">
            <input type="text" id="userAddress" name="userAddress" readonly  th:value="${user.userAddress}">
            <button type="button" id="findAddressBtn" onclick="openPostcode()">ì£¼ì†Œ ì°¾ê¸°</button> <!-- ì£¼ì†Œ ì°¾ê¸° ë²„íŠ¼ -->
          </div>


          <!-- ì§€ë„ í‘œì‹œí•  ì˜ì—­ -->
          <div id="map" style="width:100%; height:300px;"></div>

          <!-- ì„ íƒí•œ ì£¼ì†Œë¥¼ ë³´ì—¬ì¤„ ì˜ì—­ -->
          <div id="address"></div>
        </div>


        <div class="form-row">
            <label>í¬ë§ì§ì¢… (ì„ íƒ)</label>
            <button type="button" id="selectJobBtn" onclick="openJobPopup()">í¬ë§ ì§ì¢… ì„ íƒ</button>

          <div id="selectedJobList" style="margin-top: 10px;">

          </div>

            <div id="jobPopup" class="popup">
              <h2 style="text-align: center; padding: 20px; border-bottom: 1px solid #eee">í¬ë§ì§ë¬´</h2>
              <div class="searchCheckBoxJobType">

                <!--ê²€ìƒ‰ ì„¸ë¶€ 3ê°œê¹Œì§€ / ê°€ë¡œ 7 ì„¸ë¡œ 3-->
                <div class="searchCheckTopCategoryJobType" id="topCategoryList">
                  <button class="popupClose" onclick="closeJobPopup()">
                    <i class="fa-solid fa-x"></i>
                  </button>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="01"><span>ê²½ì˜Â·ì‚¬ë¬´Â·ê¸ˆìœµÂ·ë³´í—˜</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="02"><span>ì—°êµ¬ ë° ê³µí•™ê¸°ìˆ </span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="03"><span>êµìœ¡Â·ë²•ë¥ Â·ì‚¬íšŒë³µì§€Â·ê²½ì°°Â·ì†Œë°© ë° êµ°ì¸</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="04"><span>ë³´ê±´Â·ì˜ë£Œ</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="05"><span>ì˜ˆìˆ Â·ë””ìì¸Â·ë°©ì†¡Â·ìŠ¤í¬ì¸ </span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="06"><span>ë¯¸ìš©Â·ì—¬í–‰Â·ìˆ™ë°•Â·ìŒì‹Â·ê²½ë¹„Â·ëŒë´„Â·ì²­ì†Œ</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="07"><span>ì˜ì—…Â·íŒë§¤Â·ìš´ì „Â·ìš´ì†¡</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="08"><span>ê±´ì„¤Â·ì±„êµ´</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="09"><span>ì„¤ì¹˜Â·ì •ë¹„Â·ìƒì‚°-ê¸°ê³„Â·ê¸ˆì†Â·ì¬ë£Œ</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="10"><span>ì„¤ì¹˜Â·ì •ë¹„Â·ìƒì‚°-ì „ê¸°Â·ì „ìÂ·ì •ë³´í†µì‹ </span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="11"><span>ì„¤ì¹˜Â·ì •ë¹„Â·ìƒì‚°-í™”í•™Â·í™˜ê²½Â·ì„¬ìœ Â·ì˜ë³µÂ·ì‹í’ˆê°€ê³µ</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="12"><span>ì„¤ì¹˜Â·ì •ë¹„Â·ìƒì‚°-ì¸ì‡„Â·ëª©ì¬Â·ê³µì˜ˆ ë° ì œì¡° ë‹¨ìˆœ</span><i class="fa-solid fa-chevron-right"></i></div>
                  <div><input type="radio" class="topCategoryCheckJobType" name = "topCategory" value="13"><span>ë†ë¦¼ì–´ì—…ì§</span><i class="fa-solid fa-chevron-right"></i></div>


                </div>
                <div class="searchCheckUnderCategoryJobType" id="underCategoryList">


                </div>

              </div>

              <div class="signupBtn">
                <button type="button" id="jobSignup">
                  ë“±ë¡
                </button>
              </div>
            </div>
         </div>

        <div class="form-row">
          <label>í¬ë§ê³ ìš©í˜•íƒœ (ìµœëŒ€ 3ê°œ)</label>
          <div class="option-group">
            <label><input type="checkbox" name="wantJobType" value="ì •ê·œì§" th:checked="${userWantJobTypeList.contains('ì •ê·œì§')}"> ì •ê·œì§</label>
            <label><input type="checkbox" name="wantJobType" value="ê³„ì•½ì§"  th:checked="${userWantJobTypeList.contains('ê³„ì•½ì§')}"> ê³„ì•½ì§</label>
            <label><input type="checkbox" name="wantJobType" value="ì¸í„´"  th:checked="${userWantJobTypeList.contains('ì¸í„´')}"> ì¸í„´</label>
            <label><input type="checkbox" name="wantJobType" value="ì•„ë¥´ë°”ì´íŠ¸"  th:checked="${userWantJobTypeList.contains('ì•„ë¥´ë°”ì´íŠ¸')}"> ì•„ë¥´ë°”ì´íŠ¸</label>
          </div>
        </div>

        <div class="form-row">
          <label>í¬ë§ì§ì¢…ê²½ë ¥</label>
          <div class="option-group">
            <label><input type="radio" name="wantJobWorkexpHowlong" value="0" th:checked="${user.wantJobWorkexpHowlong == '0'}"> ì—†ìŒ</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="1" th:checked="${user.wantJobWorkexpHowlong == '1'}"> 1ë…„ ì´í•˜</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="2" th:checked="${user.wantJobWorkexpHowlong == '2'}"> 1ë…„~2ë…„</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="3" th:checked="${user.wantJobWorkexpHowlong == '3'}"> 2ë…„ ì´ìƒ</label>
          </div>
        </div>

        <div class="form-group terms-box">
          <label class="terms-title">ê°€ì… ì•½ê´€</label>
          <div class="terms-inner-box">
            <div class="terms-item">
              <label><input type="checkbox" class="agree" required> ê°œì¸íšŒì› ì•½ê´€ ë™ì˜(í•„ìˆ˜)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree" required> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜(í•„ìˆ˜)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree"> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ - ì´ë©”ì¼(ì„ íƒ)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree"> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ - MMS(ì„ íƒ)</label>
            </div>
          </div>
          <div class="terms-all">
            <label><input type="checkbox" id="checkAll"> <strong>ì „ì²´ ë™ì˜</strong></label>
            <p class="terms-desc">ìœ„ì˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•©ë‹ˆë‹¤.</p>
          </div>
        </div>

        <button type="submit" class="submit-btn">íšŒì› ìˆ˜ì •í•˜ê¸°</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById("checkAll").addEventListener("change", function () {
    document.querySelectorAll(".agree").forEach(chk => chk.checked = this.checked);
  });

  document.querySelectorAll(".agree").forEach(chk => {
    chk.addEventListener("change", function () {
      const allChecked = Array.from(document.querySelectorAll(".agree")).every(cb => cb.checked);
      document.getElementById("checkAll").checked = allChecked;
    });
  });

  document.querySelector(".submit-btn").addEventListener("click", function (e) {
    e.preventDefault();

    const id = document.getElementById("id");
    const pw = document.getElementById("password");
    const pwCheck = document.getElementById("passwordCheck");
    const name = document.getElementById("name");
    const gender = document.querySelector('input[name="userGender"]:checked');
    const birthYear = document.getElementById("birthYear").value.trim();
    const birthMonth = document.getElementById("birthMonth").value.trim();
    const birthDay = document.getElementById("birthDay").value.trim();
    const userBirthday = document.getElementById("userBirthday");

    const phone = document.querySelector('input[name="userPhone"]');
    const email = document.querySelector('input[name="userEmail"]');
    const employmentTypes = document.querySelectorAll('.option-group input[type="checkbox"]');
    const career = document.querySelector('input[name="wantJobWorkexpHowlong"]:checked');

    const redId = /^[a-z0-9]{6,20}$/i;
    const redPw = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+]).{8,16}$/;
    const phoneRegex = /^\d{3}-\d{3,4}-\d{4}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!id.value || !redId.test(id.value)) return alert("ì˜¬ë°”ë¥¸ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (!pw.value || !redPw.test(pw.value)) return alert("ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (pw.value !== pwCheck.value) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
    if (!name.value) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (!gender) return alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

    if (!/^\d{4}$/.test(birthYear) || birthYear < 1900) return alert("ì¶œìƒë…„ë„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (birthMonth < 1 || birthMonth > 12) return alert("ì›”ì€ 1~12 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
    if (birthDay < 1 || birthDay > 31) return alert("ì¼ì€ 1~31 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
    const maxDay = new Date(birthYear, birthMonth, 0).getDate();
    if (birthDay > maxDay) return alert(`${birthMonth}ì›”ì€ ${maxDay}ì¼ê¹Œì§€ ìˆìŠµë‹ˆë‹¤`);
    userBirthday.value = `${birthYear}-${birthMonth.padStart(2, '0')}-${birthDay.padStart(2, '0')}`;

    if (!phoneRegex.test(phone.value)) return alert("ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš” (ì˜ˆ: 010-1234-5678)");
    if (!emailRegex.test(email.value)) return alert("ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”");

    const checkedEmployment = Array.from(employmentTypes).filter(cb => cb.checked);
    if (checkedEmployment.length === 0 || checkedEmployment.length > 3) return alert("ê³ ìš©í˜•íƒœëŠ” 1~3ê°œ ì„ íƒí•´ì£¼ì„¸ìš”");
    if (!career) return alert("ê²½ë ¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

    alert("íšŒì›ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰");
    document.forms["registForm"].submit();
  });




    const userIdInput = document.getElementById('id');
    const resultSpan = document.getElementById('check-result');

    userIdInput.addEventListener('input', function () {
      const userId = userIdInput.value;

      // ì…ë ¥ ì•ˆ í–ˆìœ¼ë©´ ë¦¬ì…‹
      if (userId.trim() === '') {
        resultSpan.textContent = '';
        resultSpan.style.color = '';
        return;
      }

      fetch(`/user/check-id?userId=${encodeURIComponent(userId)}`)
              .then(response => response.text())
              .then(data => {
                console.log('ì„œë²„ ì‘ë‹µ:', data);

                if (data === 'duplicate') {
                  resultSpan.textContent = 'ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'red';
                } else if (data === 'available') {
                  resultSpan.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'green';
                } else {
                  resultSpan.textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'gray';
                }
              })
              .catch(error => {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                resultSpan.textContent = 'ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤.';
                resultSpan.style.color = 'orange';
              });
    });


  // ì„ íƒí•œ ì¤‘ë¶„ë¥˜ ì €ì¥í•  ë°°ì—´
  var selectedJobs = [];

  // íŒì—… ì—´ê¸°
  function openJobPopup() {
    document.getElementById("jobPopup").style.display = "flex";  // íŒì—…ì„ ë³´ì´ê²Œ í•¨

    // íŒì—… ì—´ ë•Œ ì„ íƒí•œ ê²ƒ ë¯¸ë¦¬ ì¹ í•˜ê¸°
    setTimeout(() => { // DOMì´ ì™„ì „íˆ ì—´ë¦¬ê³  ë‚˜ì„œ ì ìš©
      var checkboxes = document.querySelectorAll('.searchCheckJobType');
      checkboxes.forEach(function(checkbox) {
        var jobName = checkbox.nextElementSibling.textContent.trim();
        if (selectedJobs.some(job => job.name === jobName)) {
          checkbox.checked = true;
          var article = checkbox.closest('article');
          article.style.borderColor = '#ffffff';
          article.style.backgroundColor = '#255EEE';
          article.style.color = '#ffffff';
          article.style.padding = '13px';
        }
      });
    }, 100);
  }

  // íŒì—… ë‹«ê¸°
  function closeJobPopup() {
    document.getElementById("jobPopup").style.display = "none";  // íŒì—…ì„ ìˆ¨ê¹€
  }

  // "ë“±ë¡" ë²„íŠ¼ í´ë¦­
  document.getElementById('jobSignup').addEventListener('click', function() {
    var selectedCheckboxes = document.querySelectorAll('.searchCheckJobType:checked');

    if (selectedCheckboxes.length === 0) {
      alert('í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤!');
      return;
    }

    selectedJobs = [];
    selectedCheckboxes.forEach(function (checkbox){
      selectedJobs.push({
        value: checkbox.value,
        name: checkbox.nextElementSibling.textContent.trim()
      });
    });

    renderSelectedJobs(); // í™”ë©´ì— ë¿Œë¦¬ê¸°
    closeJobPopup();

  })


  function renderSelectedJobs(){
    var selectedJobList = document.getElementById('selectedJobList');
    selectedJobList.innerHTML = '';

    selectedJobs.forEach(function(job, idx) {
      var span = document.createElement('span');
      span.style.display = 'inline-block';
      span.style.padding = '8px 10px';
      span.style.margin = '5px';
      // span.style.backgroundColor = 'var(--sub-color2)';
      span.style.border = '1px solid var(--main-color1)';
      span.style.borderRadius = '20px';
      span.style.position = 'relative';
      span.style.fontSize = '14px';
      span.style.color = 'var(--main-color1)';

      var textNode = document.createTextNode(job.name);

      // ì‚­ì œ ë²„íŠ¼
      var deleteBtn = document.createElement('span');
      deleteBtn.textContent = ' Ã—';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.style.marginLeft = '5px';
      // deleteBtn.style.color = 'red';

      deleteBtn.addEventListener('click', function() {
        selectedJobs.splice(idx, 1); // ë°°ì—´ì—ì„œë„ ì‚­ì œ
        renderSelectedJobs(); // ë‹¤ì‹œ ë Œë”ë§

        // íŒì—… ì—´ë ¤ ìˆìœ¼ë©´ ì²´í¬ë°•ìŠ¤ ìƒíƒœë„ ë°”ë¡œ ì—…ë°ì´íŠ¸
        var checkboxes = document.querySelectorAll('.searchCheckJobType');
        checkboxes.forEach(function(checkbox) {
          if (checkbox.nextElementSibling.textContent.trim() === job.name) {
            checkbox.checked = false;
            var article = checkbox.closest('article');
            article.style.borderColor = '#D0D0D0';
            article.style.backgroundColor = '#ffffff';
            article.style.color = '#000000';
          }
        });
      });

      span.appendChild(textNode);
      span.appendChild(deleteBtn);

      selectedJobList.appendChild(span);
    });

  };


  //   íŒì—… ë‚´ìš©
  var fakeCheckBoxJobType = document.querySelectorAll('.searchCheckUnderCategoryJobType > div')

  var searchCheckTopCategoryJobType = document.querySelectorAll('.searchCheckTopCategoryJobType > div')
  var searchCheckUnderCategoryJobType = document.querySelector('.searchCheckUnderCategoryJobType')


  //ëŒ€ë¶„ë¥˜
  for(var i = 0; i<searchCheckTopCategoryJobType.length; i++ ) {
    (function(index) {
      searchCheckTopCategoryJobType[index].addEventListener('click', function() {

        for(var j=0; j< searchCheckTopCategoryJobType.length; j++) {
          searchCheckTopCategoryJobType[j].style.borderColor='#d0d0d0';
          searchCheckTopCategoryJobType[j].style.backgroundColor='#ffffff';
          searchCheckTopCategoryJobType[j].style.color='#000000'
          var icon = searchCheckTopCategoryJobType[j].querySelector("i");
          if (icon) {
            icon.style.color = "#777"; // ì›í•˜ëŠ” ìƒ‰ìƒìœ¼ë¡œ
          }
        }

        var radioBox = searchCheckTopCategoryJobType[index].querySelector('.topCategoryCheckJobType')

        radioBox.checked = true;


        searchCheckTopCategoryJobType[index].style.borderColor = '#ffffff';
        searchCheckTopCategoryJobType[index].style.backgroundColor = '#255EEE';
        searchCheckTopCategoryJobType[index].style.color = '#ffffff';
        searchCheckTopCategoryJobType[index].querySelector("i").style.color = "#fff";


        searchCheckUnderCategoryJobType.style.display = 'inline-block';

        //ëŒ€ë¶„ë¥˜ ë‚˜íƒ€ë‚´ê¸°
        // âœ… ì—¬ê¸°ì— ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤
        var selectedCategoryNum = radioBox.value; // ëŒ€ë¶„ë¥˜ ë²ˆí˜¸
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/api/category/secondary?primary=' + selectedCategoryNum, true);

        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4 && xhr.status === 200) { //ì„œë²„ì—ì„œ ì‘ë‹µì´ ì˜¤ë©´ í˜¸ì¶œë˜ëŠ” ì½œë°± //4ëŠ” ìš”ì²­ì™„ë£Œ 200ì€ ì‘ë‹µì„±ê³µ
            var responseData = JSON.parse(xhr.responseText); //json ë¬¸ìì—´ ê°ì²´ ë³€í™˜

            // ğŸ‘‰ ì—¬ê¸°ì— ì¤‘ë¶„ë¥˜ HTMLì„ ë Œë”ë§í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤
            searchCheckUnderCategoryJobType.innerHTML = ''; // ê¸°ì¡´ ê²ƒ ì§€ìš°ê³ 

            for (var k = 0; k < responseData.length; k++) {
              var item = responseData[k];

              //ë¹ˆ ì»¬ëŸ¼ì´ë©´ skip
              if (!item.secondaryCategoryName || item.secondaryCategoryName.trim() === '') {
                continue;
              }

              var article = document.createElement('article');
              article.innerHTML = '<input type="checkbox" name="preferredJobTypes" class="searchCheckJobType" value="' + item.secondaryCategoryNum + '">' +
                      '<span>' + item.secondaryCategoryName + '</span>';
              searchCheckUnderCategoryJobType.appendChild(article);
            }
          }
        };
        xhr.send();

      });

    })(i);

  }


  //ì¤‘ë¶„ë¥˜ 3ê°œê¹Œì§€

  searchCheckUnderCategoryJobType.addEventListener('click', function(e) {
    // í´ë¦­í•œ ëŒ€ìƒì´ ì²´í¬ë°•ìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” divì¸ì§€ í™•ì¸
    var div = e.target.closest('article');

    // ì²´í¬ë°•ìŠ¤ê°€ ìˆëŠ” divë§Œ ì²˜ë¦¬
    if (!fakeCheckBoxJobType) {
      return;
    }

    var checkbox = div.querySelector('input[type="checkbox"]');

    // í´ë¦­í•œ ì²´í¬ë°•ìŠ¤ê°€ ì´ë¯¸ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ í•´ì œ
    if (checkbox.checked) {
      checkbox.checked = false;
      div.style.borderColor = '#D0D0D0';  // ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ ë³µì›
      div.style.backgroundColor = '#ffffff';
      div.style.color = '#000000';
    } else {
      var checkedCount = document.querySelectorAll('.searchCheckJobType:checked').length;

      // ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•˜ë„ë¡ ì œí•œ
      if (checkedCount >= 3) {
        alert('ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
        return;
      }

      checkbox.checked = true;
      div.style.borderColor = '#ffffff';  // ì„ íƒëœ ìŠ¤íƒ€ì¼ ì ìš©
      div.style.backgroundColor = '#255EEE';
      div.style.color = '#ffffff';
      div.style.padding = '13px';
      div.style.marginTop = '1px';
    }
  });







</script>

<div th:replace="include/footer :: footerFragment"></div>

<script src="../css/js/header.js"></script>

<script>
  // ì£¼ì†Œ ì°¾ê¸° í•¨ìˆ˜
  function openPostcode() {
    new daum.Postcode({
      oncomplete: function(data) {
        var address = data.roadAddress;
        document.getElementById('userAddress').value = address;

        // ì£¼ì†Œì˜ ìœ„ë„, ê²½ë„ë¥¼ ê°€ì ¸ì™€ ì§€ë„ì— í‘œì‹œ
        var geocoder = new kakao.maps.services.Geocoder();
        geocoder.addressSearch(address, function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            console.log(coords);
            map.setCenter(coords);
            var marker = new kakao.maps.Marker({
              position: coords
            });
            marker.setMap(map);
          } else{
            console.log("ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨");
          }
        });
      }
    }).open();
  }
</script>
</body>
</html>
